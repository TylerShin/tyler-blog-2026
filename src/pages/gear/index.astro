---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import TopLayout from "@layouts/TopLayout.astro";
import BottomLayout from "@layouts/BottomLayout.astro";
import { GEAR } from "@consts";

const allGear = await getCollection("gear");
const collection = allGear
    .filter((item) => {
        const lang = item.data.lang || "ko";
        return lang === "ko";
    })
    .sort(
        (a, b) =>
            new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
    );

const gear = collection.map((item) => ({
    ...item,
    slug: item.slug.replace(/^ko\//, ""),
}));

function formatWorkDate(input: Date | string) {
    if (typeof input === "string") return input;

    const month = input.toLocaleDateString("en-US", {
        month: "short",
    });

    const year = new Date(input).getFullYear();
    return `${month} ${year}`;
}
---

<PageLayout title={GEAR.TITLE} description={GEAR.DESCRIPTION}>
    <TopLayout>
        <div class="animate page-heading">
            {GEAR.TITLE}
        </div>
    </TopLayout>
    <BottomLayout>
        <div class="animate flex flex-col gap-4">
            {
                gear.map((entry) => (
                    <a
                        href={`/gear/${entry.slug}`}
                        class="group p-4 gap-3 flex items-center border rounded-lg hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 transition-colors duration-300 ease-in-out"
                    >
                        {entry.data.thumbnail && (
                            <div class="w-20 h-20 flex-none rounded-md overflow-hidden bg-gray-100 dark:bg-gray-800 border border-black/10 dark:border-white/10">
                                <img
                                    src={entry.data.thumbnail}
                                    alt={entry.data.title}
                                    class="w-full h-full object-cover"
                                />
                            </div>
                        )}
                        <div class="w-full group-hover:text-black group-hover:dark:text-white blend">
                            <div class="flex flex-wrap items-center gap-2">
                                <div class="text-sm uppercase">
                                    {formatWorkDate(entry.data.date)}
                                </div>
                                {entry.data.rating && (
                                    <>
                                        <span class="text-black/50 dark:text-white/50">
                                            •
                                        </span>
                                        <span>★ {entry.data.rating}</span>
                                    </>
                                )}
                            </div>
                            <div class="font-semibold mt-3 text-black dark:text-white text-lg">
                                {entry.data.title}
                            </div>
                            <div class="text-sm font-semibold mt-1 text-black/80 dark:text-white/80 line-clamp-2">
                                {entry.data.summary}
                            </div>
                        </div>
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke-width="2.5"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="stroke-current group-hover:stroke-black group-hover:dark:stroke-white"
                        >
                            <line
                                x1="5"
                                y1="12"
                                x2="19"
                                y2="12"
                                class="scale-x-0 group-hover:scale-x-100 translate-x-4 group-hover:translate-x-1 transition-all duration-300 ease-in-out"
                            />
                            <polyline
                                points="12 5 19 12 12 19"
                                class="translate-x-0 group-hover:translate-x-1 transition-all duration-300 ease-in-out"
                            />
                        </svg>
                    </a>
                ))
            }
        </div>
    </BottomLayout>
</PageLayout>
